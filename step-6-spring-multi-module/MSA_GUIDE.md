# 멀티모듈 → MSA 전환 가이드

## 학습 목표
- 단일 모듈에서 멀티모듈로 전환하는 이유
- 멀티모듈에서 MSA로 확장
- MSA 전환 시 고려해야 할 사항


## 전환 흐름 요약
### 단일 레포
```
단일 모듈            멀티모듈

┌─────────┐      ┌────────────────┐
│         │      │ ┌─────┐ ┌─────┐│
│   All   │      │ │ App │ │Admin││
│ in One  │  →   │ └──┬──┘ └──┬──┘│
│         │      │    └──┬───┘    │
└─────────┘      │  ┌────┴────┐   │
                 │  │ common  │   │
                 │  └─────────┘   │
                 └───────────────┘ 

```
## 멀티레포 전환 (선택)

프로젝트 규모가 커지거나 팀이 분리되면 멀티레포로 전환할 수 있음.
반드시 필요한 것은 아니며, 상황에 따라 선택.

### 멀티레포 구조 예시
common 라이브러리 자체도 각 레포별로 관리할 수도 있음.  
( 규모가 크면 건드리기 부담이 많이 될 수 있음) 
```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐      │
│   │  app-repo   │   │ admin-repo  │   │ common-repo │      │
│   │             │   │             │   │             │      │
│   │  ┌───────┐  │   │  ┌───────┐  │   │  ┌───────┐  │      │
│   │  │  App  │  │   │  │ Admin │  │   │  │common │  │      │
│   │  │Service│  │   │  │Service│  │   │  │Library│  │      │
│   │  └───────┘  │   │  └───────┘  │   │  └───────┘  │      │
│   │             │   │             │   │             │      │
│   │   독립 배포   │   │   독립 배포   │   │   라이브러리   │       │
│   │  독립 CI/CD  │   │  독립 CI/CD  │   │     배포     │       │
│   └─────────────┘   └─────────────┘   └──────┬──────┘       │
│          │                   │               │              │
│          └───────────────────┴───────────────┘              │
│                          │                                  │
│                      의존성 참조                               │
│              (Maven/Gradle 라이브러리로 가져옴)                  │
└─────────────────────────────────────────────────────────────┘
```
### 단일레포 vs 멀티레포

| 항목 | 단일레포 (모노레포) | 멀티레포           |
|------|---------------------|----------------|
| 코드 공유 | 쉬움 (같은 레포) | 라이브러리 배포 관리 불편 |
| 버전 관리 | 통합 관리 | 서비스별 독립 관리    |
| CI/CD | 통합 파이프라인 | 서비스별 파이프라인    |
| 팀 독립성 | 낮음 | 높음             |

### 언제 멀티레포를 고려하나?

- 팀이 서비스별로 분리될 때
- 서비스별 독립 배포 주기가 필요할 때
- 레포 권한을 서비스별로 분리하고 싶을 때
- 코드베이스가 너무 커져서 관리가 어려울 때

> 💡 멀티레포가 항상 좋은 것은 아님.  
> 소규모 팀에서는 단일레포 멀티모듈이 더 효율적일 수 있음.


## 현재 구조에서 보이는 전환 포인트

| 현재 구조 | MSA 전환 시 |
|-----------|-------------|
| `app-service` | 독립 서비스로 분리 가능 |
| `admin-service` | 독립 서비스로 분리 가능 |
| `common` | 공통 라이브러리로 배포 |
| 모듈 의존성 | 서비스 경계의 힌트 |
| 모듈 단위 빌드 | 개별 배포 단위로 확장 가능 |


## 확장 단계 흐름

### 1단계: 단일 레포 멀티모듈 (현재)
```aiexclude
step-6-spring-multi-module/
├── app-service/      ← 실행 모듈
├── admin-service/    ← 실행 모듈
└── common/           ← 공통 모듈
```
- 공통 코드를 모듈로 분리
- 실행 모듈을 역할별로 분리
- 하나의 레포에서 관리

### 2단계: 서비스별 모듈 강화 
```aiexclude
step-6-spring-multi-module/
├── app-service/
│   └── 도메인 로직 집중 (사용자 기능)
├── admin-service/
│   └── 도메인 로직 집중 (관리자 기능)
└── common/
    └── 공통 로직만 유지 (최소화)
```
- 각 서비스에 도메인 로직 집중
- 공통 모듈 비대해지지 않도록 관리

### 3단계: 모듈별 배포 관리 (MSA)
- 각 서비스는 독립적으로 관리, 배포 한다.


### 4단계: 레포 분리 (MSA)
멀티 모듈로 관리하기 어려울 정도로 규모가 커지거나, 기술 스택이 다양하거나, 
조직 관리 효율성을 위해서 레포를 분리한다. ( 선택 )


## 멀티 모듈 환경에서 MSA를 구축할 때, 고려 해야할 것
- 각 서비스별로 빌드, 배포 환경 구축 필요. 
- 환경변수, 프로파일 등 설정을 서비스별로 분리
- 서비스별 데이터 저장소/스키마를 분리 정책 수립
- 서비스 간 통신 정책 수립
- 공통 모듈에 대한 코딩, 관리 규약
  (회사 규모가 커질수록 수정 부담 증가 → 레포 분리 검토)
- 
### 인프라/배포

| 항목 | 고려사항                        |
|------|-----------------------------|
| 빌드 | 서비스별 CI/CD 파이프라인 구축        |
| 배포 | 서비스별 독립 배포 환경 (k8s, ECS 등) |
| 설정 | 환경변수, 프로파일 서비스별 분리          |
| 모니터링 | 서비스별 로그, 메트릭 수집            |

### 데이터

| 항목 | 고려사항                      |
|------|---------------------------|
| DB 분리 | 서비스별 데이터 저장소/스키마 분리 정책 수립 |
| 데이터 정합성 | 분산 트랜잭션 처리 방안             |
| 데이터 동기화 | 이벤트 기반 동기화 등              |

### 통신

| 항목 | 고려사항 |
|------|----------|
| 동기 통신 | REST API, gRPC |
| 비동기 통신 | 메시지 큐 (Kafka, RabbitMQ) |
| 서비스 디스커버리 | 서비스 간 위치 탐색 |

### 공통 모듈

| 항목 | 고려사항 |
|------|----------|
| 버전 관리 | 라이브러리 버전 정책 |
| 배포 방식 | 내부 Maven/Gradle 저장소 |
| 변경 영향 | 공통 모듈 변경 시 모든 서비스 영향 |

> ⚠️ 공통 모듈이 커지면 수정 부담 증가 → 아예 레포를 분리하는게 더 좋기도 함.

## MSA 장단점
### 장점
서비스별 독립적인 관리를 통한 효율성 증가 ( 각자 다른 환경, 정책 개발문화 )

| 장점 | 설명                   |
|------|----------------------|
| 독립 배포 | 서비스별 독립적으로 배포 가능    |
| 기술 다양성 | 서비스별 다른 기술 스택 선택 가능 |
| 확장성 | 필요한 서비스만 스케일 아웃      |
| 장애 격리 | 한 서비스 장애가 전체에 영향 적음  |


### 단점
여러 관점에서 비용이 많이든다.    

| 단점 | 설명                        |
|------|---------------------------|
| 복잡성 증가 | 인프라, 통신, 모니터링 등 관리 포인트 증가 |
| 비용 증가 | 서비스별 인프라 비용              |
| 데이터 관리 | 분산 트랜잭션, 정합성 처리 어려움       |
| 디버깅 어려움 | 여러 서비스에 걸친 문제 추적 복잡       |
- 비용이 많이 든다. ( 개발 시간, 인프라 구축 비용, ... )
- 소규모에서는 오히려 개발 속도가 느려질 수 있다.

## Spring Cloud에 대해서 ( 개인 생각 )
 MSA 구축하는 과정에서 발생할 수 있는 문제들을 쉽게 해결할 수 있도록 지원하는 도구

| 도구 | 역할 | 해결하는 문제 |
|------|------|---------------|
| API Gateway | 단일 진입점, 라우팅 | 여러 서비스를 하나의 URL로 접근 |
| Config Server | 설정 중앙화 | 서비스별 설정 파일 흩어짐 방지 |
| Eureka | 서비스 디스커버리 | 서비스 위치(IP/포트)를 동적으로 찾기 |
| Resilience4j | 서킷브레이커 | 한 서비스 장애가 전체로 퍼지는 것 방지 |


> 💡 개요 정도만 숙지하고, 필요할 때 학습하는 것을 권장.  
> 현재 단계에서 직접 구축하는 것은 학습 효율이 낮을 수 있음.  
> 실제 구축하는 과정이 궁금하다면 아래 유투브 링크 참고   
> ( https://www.youtube.com/watch?v=O1un1Nf810Y&list=PLJkjrxxiBSFBPk-6huuqcjiOal1KdU88R )


## 정리

- MSA는 구축 방법에 따라서 비용이 많이들 수 있다.
- 소규모 프로젝트에서는 큰 효과가 없을 수 있다.
- 기술적인 도전을 목표로 한다면 얼마든 지 권장.
- 단, MSA가 장단점이 있고 만능은 아니라는 점, 구축 방법도 다양하게 있다는 것을 느꼈으면 좋겠음.